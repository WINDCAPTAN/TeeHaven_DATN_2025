<!DOCTYPE html>
<html lang="en">
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <title>Tee Haven</title>
    <meta content="" name="description">
    <meta content="" name="keywords">

    <link href="../../../static/img/logo_teehaven.png" rel="icon">
    <link href="../../../static/img/apple-touch-icon.png" rel="apple-touch-icon">

    <link rel='stylesheet' href='https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css'>

    <!-- Favicons -->
    <div th:replace="~{admin-template/fragment/header :: header}"></div>


</head>
<style>
    /* Optimized Sidebar Styles */
    .sidebar {
        position: fixed;
        top: 60px;
        left: 0;
        bottom: 0;
        width: 300px;
        z-index: 996;
        transition: all 0.3s;
        padding: 20px;
        overflow-y: auto;
        scrollbar-width: thin;
        scrollbar-color: #aab7cf transparent;
        box-shadow: 0 0 20px rgba(1, 41, 112, 0.1);
        background-color: #fff;
    }

    .sidebar::-webkit-scrollbar {
        width: 5px;
        height: 8px;
        background-color: #fff;
    }

    .sidebar::-webkit-scrollbar-thumb {
        background-color: #aab7cf;
        border-radius: 10px;
    }

    .sidebar-nav {
        padding: 0;
        margin: 0;
        list-style: none;
    }

    .sidebar-nav li {
        padding: 0;
        margin: 0;
        list-style: none;
    }

    .sidebar-nav .nav-item {
        margin-bottom: 8px;
    }

    .sidebar-nav .nav-link {
        display: flex;
        align-items: center;
        font-size: 15px;
        font-weight: 500;
        color: #012970;
        background: #f6f9ff;
        padding: 12px 15px;
        border-radius: 8px;
        transition: all 0.3s;
        text-decoration: none; /* Remove underline */
    }

    .sidebar-nav .nav-link i {
        font-size: 16px;
        margin-right: 12px;
        color: #4154f1;
        transition: 0.3s;
    }

    .sidebar-nav .nav-link:hover {
        color: #4154f1;
        background: #e0e7ff;
    }

    .sidebar-nav .nav-link:hover i {
        color: #4154f1;
    }

    .sidebar-nav .nav-link.collapsed {
        color: #012970;
        background: #f6f9ff;
    }

    .sidebar-nav .nav-link.collapsed i {
        color: #899bbd;
    }

    .sidebar-nav .nav-link:not(.collapsed) {
        color: #4154f1;
        background: #e0e7ff;
        font-weight: 600;
    }

    .sidebar-nav .nav-link:not(.collapsed) i {
        color: #4154f1;
    }

    .sidebar-nav .nav-content {
        padding: 5px 0 0 0;
        margin: 0;
        list-style: none;
    }

    .sidebar-nav .nav-content a {
        display: flex;
        align-items: center;
        font-size: 14px;
        font-weight: 400;
        color: #012970;
        padding: 10px 0 10px 40px;
        transition: 0.3s;
        text-decoration: none; /* Remove underline */
    }

    .sidebar-nav .nav-content a i {
        font-size: 10px;
        margin-right: 8px;
        line-height: 0;
        border-radius: 50%;
    }

    .sidebar-nav .nav-content a:hover,
    .sidebar-nav .nav-content a.active {
        color: #4154f1;
    }

    .sidebar-nav .nav-content a.active i {
        background-color: #4154f1;
        color: #fff;
    }

    /* Optimized Header Styles */
    .header {
        transition: all 0.3s;
        z-index: 997;
        height: 60px;
        box-shadow: 0 2px 20px rgba(1, 41, 112, 0.1);
        background-color: #fff;
        padding-left: 20px;
    }

    .header .toggle-sidebar-btn {
        font-size: 24px;
        padding-left: 10px;
        cursor: pointer;
        color: #012970;
        transition: 0.3s;
    }

    .header .toggle-sidebar-btn:hover {
        color: #4154f1;
        transform: scale(1.1);
    }

    .logo {
        line-height: 1;
        text-decoration: none; /* Remove underline */
    }

    .logo img {
        max-height: 35px;
        margin-right: 10px;
    }

    .logo span {
        font-size: 20px;
        font-weight: 700;
        color: #012970;
        font-family: "Nunito", sans-serif;
    }

    /* Remove underline from all links in the sidebar and header */
    #sidebar a, #header a {
        text-decoration: none;
    }

    /* Main Content Adjustments */
    #main {
        margin-top: 60px;
        padding: 20px 30px;
        transition: all 0.3s;
    }

    @media (max-width: 1199px) {
        .sidebar {
            left: -300px;
        }

        .toggle-sidebar .sidebar {
            left: 0;
        }

        #main {
            margin-left: 0;
        }

        .toggle-sidebar #main {
            margin-left: 0;
        }
    }

    /* Active menu item styles */
    .sidebar-nav .nav-content a.active {
        background-color: #e0e7ff;
        border-radius: 5px;
        padding-left: 38px;
        border-left: 2px solid #4154f1;
        font-weight: 500;
    }

    /* Responsive adjustments */
    @media (min-width: 1200px) {
        .logo {
            width: 280px;
        }

        #main {
            margin-left: 300px;
        }
    }

    /* Table styles */
    .trangthaidkd {
        color: #2ecc71;
        font-weight: 600;
    }

    .trangthainkd {
        color: #e74c3c;
        font-weight: 600;
    }

    /* Toast notification improvements */
    .toast {
        border-radius: 10px !important;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
</style>
<body>

<!-- ======= Header ======= -->
<header id="header" class="header fixed-top d-flex align-items-center">
    <div class="d-flex align-items-center justify-content-between">
        <a href="/ban-hang-tai-quay/hoa-don" class="logo d-flex align-items-center">
            <img src="../../../static/img/logo_teehaven.png" alt="">
            <span class="d-none d-lg-block">Tee Haven</span>
        </a>
        <i class="bi bi-list toggle-sidebar-btn"></i>
    </div><!-- End Logo -->
    <nav class="header-nav ms-auto">
        <ul class="d-flex align-items-center">
            <li class="nav-item dropdown pe-3">
                <a class="nav-link nav-profile d-flex align-items-center pe-0" href="#" data-bs-toggle="dropdown">
                    <span class="d-none d-md-block dropdown-toggle ps-2" th:text="${tenNhanVien}"></span>
                </a><!-- End Profile Iamge Icon -->

                <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow profile">
                    <li class="dropdown-header">
                        <h6 th:text="${tenNhanVien}"></h6>
                        <span>Nhân Viên</span>
                    </li>
                    <li>
                        <hr class="dropdown-divider">
                    </li>
                    <li>
                        <a class="dropdown-item d-flex align-items-center" th:href="@{/logout}">
                            <i class="bi bi-box-arrow-right"></i>
                            <span>Đăng Xuất</span>
                        </a>
                    </li>
                </ul><!-- End Profile Dropdown Items -->
            </li><!-- End Profile Nav -->
        </ul>
    </nav><!-- End Icons Navigation -->
</header><!-- End Header -->

<!-- ======= Sidebar ======= -->
<aside id="sidebar" class="sidebar">

    <ul class="sidebar-nav" id="sidebar-nav">
        <li class="nav-item">
            <a class="nav-link collapsed" href="/admin/thong-ke">
                <i class="bi bi-graph-up-arrow"></i>
                <span>Thống Kê</span>
            </a>
        </li>

        <li class="nav-item">
            <a class="nav-link collapsed" href="/ban-hang-tai-quay/hoa-don" id="ban-hang-nav">
                <i class="bi bi-shop"></i>
                <span>Bán Hàng</span>
            </a>
        </li><!-- End Dashboard Nav -->

        <li class="nav-item">
            <a class="nav-link collapsed" data-bs-target="#components-nav" data-bs-toggle="collapse" href="#">
                <i class="bi bi-menu-button-wide"></i><span>Quản Lý Sản Phẩm</span><i
                    class="bi bi-chevron-down ms-auto"></i>
            </a>
            <ul id="components-nav" class="nav-content collapse" data-bs-parent="#sidebar-nav">
                <li>
                    <a href="/admin/san-pham-chi-tiet">
                        <i class="bi bi-circle"></i><span>Sản Phẩm Chi Tiết</span>
                    </a>
                </li>
                <li>
                    <a href="/admin/san-pham">
                        <i class="bi bi-circle"></i><span>Sản Phẩm</span>
                    </a>
                </li>
                <li>
                    <a href="/admin/thuong-hieu">
                        <i class="bi bi-circle"></i><span>Thương Hiệu</span>
                    </a>
                </li>
                <li>
                    <a href="/admin/tay-ao">
                        <i class="bi bi-circle"></i><span>Tay áo</span>
                    </a>
                </li>
                <li>
                    <a href="/admin/mau-sac">
                        <i class="bi bi-circle"></i><span>Màu Sắc</span>
                    </a>
                </li>
                <li>
                    <a href="/admin/kich-co">
                        <i class="bi bi-circle"></i><span>Kích Cỡ</span>
                    </a>
                </li>
            </ul>
        </li><!-- End Components Nav -->

        <li class="nav-item">
            <a class="nav-link collapsed" href="/hoa-don/quan-ly">
                <i class="bi bi-receipt-cutoff"></i>
                <span>Quản Lý Hóa Đơn</span>
            </a>
        </li><!-- End Forms Nav -->

        <li class="nav-item">
            <a class="nav-link" data-bs-target="#tables-nav" data-bs-toggle="collapse" href="#">
                <i class="bi bi-person-vcard"></i><span>Quản Lý Tài Khoản</span><i
                    class="bi bi-chevron-down ms-auto"></i>
            </a>
            <ul id="tables-nav" class="nav-content collapse show" data-bs-parent="#sidebar-nav">
                <li>
                    <a href="/admin/nhan-vien">
                        <i class="bi bi-circle"></i><span>Quản lý nhân viên</span>
                    </a>
                </li>
                <li>
                    <a href="/admin/khach-hang" >
                        <i class="bi bi-circle"></i><span>Quản lý khách hàng</span>
                    </a>
                </li>
            </ul>
        </li><!-- End Tables Nav -->

        <li class="nav-item">
            <a class="nav-link collapsed" href="/admin/voucher">
                <i class="bi bi-ticket-perforated-fill"></i>
                <span>Quản Lý Voucher</span>
            </a>
        </li><!-- End Icons Nav -->
    </ul>

</aside><!-- End Sidebar-->

<main id="main" class="main">
    <section class="section">
        <div class="row">
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h5 class="m-0">Danh sách hóa đơn</h5>
                            <div class="tao-hd">
                                <a th:if="${listHoaDon.size() < 5}" id="postLink" class="btn btn-success">Tạo Hóa
                                    đơn</a>
                                <button th:if="${listHoaDon.size() >= 5}" type="button" class="btn btn-success"
                                        data-bs-toggle="modal" data-bs-target="#error5HoaDon">Tạo Hóa đơn
                                </button>

                                <!-- Modal -->
                                <div class="modal fade" id="error5HoaDon" tabindex="-1" role="dialog"
                                     aria-labelledby="modalTitleId" aria-hidden="true">
                                    <div class="modal-dialog modal-lg" role="document"
                                         style="margin-left: auto; margin-right: auto;">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="modalTitleId">Thông báo</h5>
                                            </div>
                                            <div class="modal-body">
                                                <div style="text-align: center;" class="container-fluid">
                                                    Bạn chỉ có thể tạo tối đa 5 hóa đơn!
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary"
                                                        data-bs-dismiss="modal">Đóng
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <script>
                                    document.getElementById("postLink").addEventListener("click", function (event) {
                                        event.preventDefault(); // Ngăn chặn thực hiện mặc định của thẻ <a>

                                        var form = document.createElement("form");
                                        form.method = "POST";
                                        form.action = "/ban-hang-tai-quay/hoa-don/add"; // Đặt URL mà bạn muốn gửi yêu cầu POST đến

                                        var input = document.createElement("input");
                                        input.type = "hidden";
                                        input.name = "key";
                                        input.value = "value"; // Dữ liệu bạn muốn gửi

                                        form.appendChild(input);

                                        document.body.appendChild(form);
                                        form.submit();
                                    });
                                </script>
                            </div>
                        </div>
                        <div class="tab-pane fade show active" id="tao-moi" role="tabpanel"
                             aria-labelledby="tao-moi-tab">
                            <div class="hoa-don">
                                <div th:each="hd : ${listHoaDon}" class="btn-group" role="group"
                                     aria-label="Basic outlined example">
                                    <a th:text="${hd.maHoaDon}"
                                       th:href="@{'/ban-hang-tai-quay/hoa-don/' + ${hd.id}}"
                                       th:class="${hd.id == hoaDon.id ? 'btn btn-outline-primary active' : 'btn btn-outline-primary'}"></a>
                                </div>
                            </div>
                        </div>

                        <div th:if="${hoaDon.trangThai !=-1}">
                            <h1 style="text-align: center;">[[${hoaDon.maHoaDon}]] - Chờ thanh toán</h1>
                            <a class="btn btn-link" style="float: left;margin-top: 1%;"
                               href="/ban-hang-tai-quay/hoa-don/quan-ly">
                                <i class=" bi bi-arrow-left-circle-fill"></i>
                            </a>
                        </div>
                        <div class="d-flex justify-content-end align-items-center" style="margin-top: 1%;">
                            <button onclick="handleButtonClick()" type="button"
                                    class="btn btn-primary" data-bs-toggle="modal"
                                    th:data-bs-target="${'#addsp'+hoaDon.id}">
                                Thêm sản phẩm
                            </button>
                        </div>

                        <!-- Table Sản Phẩm-->
                        <div class="table-ban-hang">
                            <table class="sanpham-table">
                                <thead>
                                <tr>
                                    <th scope="col">STT</th>
                                    <th scope="col">Sản phẩm</th>
                                    <th scope="col">Số lượng</th>
                                    <th scope="col">Thành tiền</th>
                                    <th scope="col"
                                        th:if="${hoaDon.trangThai!=2&&hoaDon.trangThai!=5}">
                                        Thao tác
                                    </th>

                                </tr>
                                </thead>
                                <tbody>


                                <tr th:each="obj, state:${hoaDon.lstHoaDonChiTiet}">

                                    <form th:id="${'myForm'+obj.id}"
                                          action="/ban-hang-tai-quay/hoa-don-chi-tiet/update"
                                          method="post">

                                        <th scope="row" th:text="${state.index+1}"></th>
                                        <td>
                                            <div class="row">
                                                <div class="col-4">
                                                    <div th:each="url : ${#strings.listSplit(obj.chiTietSanPham.sanPham.hinhAnh, ',')[0]}"
                                                         style="display: inline-block; margin-right: 5px;">
                                                        <img th:src="${url}" alt="Hình ảnh sản phẩm"
                                                             style="width: 100px; height: auto;"/>
                                                    </div>
                                                </div>
                                                <div class="col-8">
                                                    <div class="info-price">
                                                        <h6>[[${obj.ChiTietSanPham.SanPham.ten}]]
                                                            [
                                                            [[${obj.ChiTietSanPham.MauSac.ten}]]
                                                            -
                                                            [[${obj.ChiTietSanPham.KichCo.ten}]]
                                                            ]
                                                        </h6>
                                                        <span>Đơn giá: <span class="gia">
                                                                                        [[${#numbers.formatDecimal(obj.DonGia, 0, 'POINT', 0, 'POINT') + ' VNĐ'}]]
                                                                                        </span></span>
                                                        <p>Tay áo:
                                                            [[${obj.ChiTietSanPham.TayAo.ten}]]
                                                        </p>
                                                        <span
                                                                th:if="${obj.soLuong>obj.ChiTietSanPham.soLuong}"
                                                                style="color: rgb(208, 255, 0); font-weight: bold;background-color: red;">Số
                                                                                    lượng còn:
                                                                                    [[${obj.ChiTietSanPham.soLuong}]]</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            [[${obj.soLuong}]]
                                        </td>

                                        <td>
                                            <div class="price-table">



                                                [[${#numbers.formatDecimal(obj.tongTien(), 0, 'POINT', 0, 'POINT') + ' VNĐ'}]]

                                            </div>
                                        </td>


                                        <td
                                                th:if="${hoaDon.trangThai!=2&&hoaDon.trangThai!=3&&hoaDon.trangThai!=5}">
                                            <div class="button-table">
                                                <!-- delete Hóa đơn chi tiết -->

                                                <!-- Button trigger modal -->

                                                <button type="button" class="btn btn-primary"
                                                        th:data-bs-toggle="modal"
                                                        th:data-bs-target="${'#modalEditSoLuong'+obj.id}">
                                                    Sửa
                                                    <input type="hidden" name="idHdct"
                                                           th:value="${obj.id}">
                                                </button>

                                                <!-- Modal update sl-->
                                                <div class="modal fade"
                                                     th:id="${'modalEditSoLuong'+obj.id}"
                                                     tabindex="-1"
                                                     aria-labelledby="exampleModalLabel"
                                                     aria-hidden="true">
                                                    <div class="modal-dialog modal-lg">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h1 class="modal-title fs-5"
                                                                    id="exampleModalLabel">Nhập
                                                                    số lượng</h1>
                                                            </div>
                                                            <form th:id="${'myForm'+obj.id}"
                                                                  th:action="@{/ban-hang-tai-quay/hoa-don-chi-tiet/update}"
                                                                  method="post">
                                                                <div class="modal-body">
                                                                    <p>(Sẵn
                                                                        [[${obj.chiTietSanPham.soLuong}]]
                                                                        sản phẩm )</p>
                                                                    <input type="number"
                                                                           name="soLuongEdit"
                                                                           th:id="${'soLuongEdit'+obj.id}">
                                                                    <input type="hidden" name="idHdct"
                                                                           th:value="${obj.id}">
                                                                </div>
                                                                <div class="error-message">
                                                                    <small th:id="${'errorSoLuongEdit'+obj.id}"
                                                                           style="color: red; display: block; margin: 10px 15px;"></small>
                                                                </div>
                                                                <div class="modal-footer">
                                                                    <button type="button"
                                                                            class="btn btn-secondary"
                                                                            data-bs-dismiss="modal">Đóng
                                                                    </button>
                                                                    <button type="button"
                                                                            th:onclick="'validateAndSubmit('+${obj.chiTietSanPham.soLuong}+','+${obj.soLuong}+','+${obj.id}+')'"
                                                                            class="btn btn-primary">Xác
                                                                        nhận
                                                                    </button>
                                                                </div>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                                <button type="button" class="btn btn-danger"
                                                        th:data-bs-toggle="modal"
                                                        th:data-bs-target="${'#modalDeleteHdct'+obj.id}"
                                                >
                                                    Xóa
                                                </button>
                                                <div class="modal fade"
                                                     th:id="${'modalDeleteHdct'+obj.id}"
                                                     tabindex="-1" role="dialog"
                                                     aria-labelledby="modalTitleId1"
                                                     aria-hidden="true">
                                                    <div class="modal-dialog modal-xl" role="document">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title"
                                                                    id="modalTitleId1">Xác nhận
                                                                </h5>

                                                            </div>
                                                            <div class="modal-body">
                                                                <div class="container-fluid">
                                                                    Xóa
                                                                    [[${obj.ChiTietSanPham.SanPham.ten}]]
                                                                    ?
                                                                </div>
                                                            </div>
                                                            <div class="modal-footer">
                                                                <button type="button"
                                                                        class="btn btn-secondary"
                                                                        data-bs-dismiss="modal">Close
                                                                </button>
                                                                <a th:href="@{'/ban-hang-tai-quay/hoa-don-chi-tiet/delete/'+${obj.id}}"
                                                                   class="btn btn-danger">Xóa
                                                                </a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                        </td>
                                    </form>
                                </tr>


                                </tbody>
                            </table>
                        </div>

                        <div th:if="${#lists.size(hoaDon.lstHoaDonChiTiet) ==0}">
                            <!-- giỏ hàng trống -->
                            <div class="cart-no-product">
                                <div style="margin: auto; margin-bottom: 8%;" class="row">
                                    <div class="col-md-12">
                                        <img th:src="@{/static/img/cart.png}" alt="">

                                    </div>

                                    <div class="col-md-12">
                                        <span style="text-align: center;">Không có sản phẩm nào trong giỏ</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--Table Khách Hàng-->
                        <div class="line"></div>

                        <div class="tai-khoan-ban-hang">
                            <div class="row mb-3">
                                <h4 class="col-sm-2" style="font-family: Arial, sans-serif;font-size: 20px;
            font-weight: bold;
            color: black;">Tài khoản</h4>


                                <div class="col-sm-10"
                                     th:if="${hoaDon.trangThai ==-1 || hoaDon.trangThai ==4}">
                                    <!---->
                                    <button type="button" class="btn btn-primary"
                                            data-bs-toggle="modal" style="float: right;"
                                            data-bs-target="#chonKhachHangModal">

                                        Chọn tài khoản
                                    </button>
                                </div>
                                <div class="" th:each=" taiKhoan: ${listTaiKhoan}">

                                    <div class="modal fade" th:id="chonKhachHangModal"
                                         tabindex="-1" aria-labelledby="chonKhachHangModalLabel"
                                         aria-hidden="true">
                                        <div class="modal-dialog modal-lg">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h1 class="modal-title fs-5"
                                                        id="chonKhachHangModalLabel">
                                                        Danh sách khách
                                                        hàng
                                                    </h1>
                                                </div>
                                                <div class="modal-body">
                                                    <!-- form tìm kiếm khách hàng -->
                                                    <div class="row mb-3">
                                                        <div class="col-sm-2 offset-10">
                                                            <button type="button"
                                                                    class="btn btn-primary"
                                                                    data-bs-toggle="modal"
                                                                    style="float: right;"
                                                                    data-bs-target="#them-khach-hang">
                                                                Thêm mới
                                                            </button>
                                                        </div>
                                                    </div>


                                                    <!-- table khách hàng -->

                                                    <table id="example1" class="display">
                                                        <thead>
                                                        <tr>
                                                            <th>STT</th>
                                                            <th>Tên Khách Hàng</th>
                                                            <th>Số Điện Thoại</th>
                                                            <th>Email</th>
                                                            <th>Hành Động</th>
                                                        </tr>
                                                        <thead>
                                                        <tbody>

                                                        <tr
                                                                th:each=" taiKhoan, state : ${listTaiKhoan}">
                                                            <form
                                                                    action="/ban-hang-tai-quay/hoa-don/add-khach-hang"
                                                                    method="post">

                                                                <td
                                                                        th:text="${state.index+1}">
                                                                </td>
                                                                <td
                                                                        th:text="${taiKhoan.hoVaTen}">
                                                                </td>
                                                                <td
                                                                        th:text="${taiKhoan.soDienThoai}">
                                                                </td>
                                                                <td
                                                                        th:text="${taiKhoan.email}">
                                                                </td>

                                                                <td>
                                                                    <input type="hidden"
                                                                           th:value="${taiKhoan.id}"
                                                                           name="idTaiKhoan">
                                                                    <input name="idhdc"
                                                                           type="hidden"
                                                                           th:value="${hoaDon.id}">
                                                                    <button
                                                                            type="submit"
                                                                            class="btn btn-success">
                                                                        Chọn
                                                                    </button>
                                                                </td>

                                                            </form>
                                                        </tr>

                                                        </tbody>
                                                        <tfoot hidden="hidden">
                                                        <tr>
                                                            <th>STT</th>
                                                            <th>Tên Khách Hàng</th>
                                                            <th>Số Điện Thoại</th>
                                                            <th>Email</th>
                                                            <th>Hành Động</th>
                                                        </tr>
                                                        </tfoot>
                                                    </table>


                                                </div>
                                                <div class="modal-footer">

                                                    <form
                                                            action="/ban-hang-tai-quay/hoa-don/add-khach-hang"
                                                            method="post">
                                                        <input type="hidden" name="idTaiKhoan"
                                                               value="-1">
                                                        <input name="idhdc" type="hidden"
                                                               th:value="${hoaDon.id}">
                                                        <button type="submit"
                                                                class="btn btn-danger">Bỏ chọn
                                                        </button>
                                                    </form>
                                                    <button type="button"
                                                            class="btn btn-secondary"
                                                            data-bs-dismiss="modal">Đóng
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- JS bật thông tin khách hàng-->
                            <!-- Modal -->
                            <div class="modal fade" id="them-khach-hang" tabindex="-1"
                                 aria-labelledby="them-khach-hangLabel" aria-hidden="true">

                                <!--js bật modal khi check-->
                                <script th:if="${checkModal=='modal'}">
                                    window.addEventListener('DOMContentLoaded', (event) => {
                                        // Hiển thị modal
                                        var myModal = new bootstrap.Modal(document.getElementById('them-khach-hang'));
                                        myModal.show();
                                    });
                                </script>
                                <!--js bật modal khi check-->

                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h1 class="modal-title fs-5"
                                                id="them-khach-hangLabel">Thêm Khách Hàng
                                            </h1>
                                        </div>
                                        <div class="modal-body">

                                            <!-- form thêm khách hàng -->
                                            <form onsubmit="return validThemKhachHang()"
                                                  class="row g-3"
                                                  style="margin-top: 1%;margin-bottom: 5%;"
                                                  method="post" enctype="multipart/form-data"
                                                  th:action="@{/ban-hang-tai-quay/khach-hang/them-nhanh}"
                                                  th:object="${khachHang}">
                                                <input type="hidden" th:value="${hoaDon.id}"
                                                       name="idhdc">
                                                <div class="col-md-6">
                                                    <label class="form-label">
                                                        <span class="dau-sao">*</span>Tên
                                                        tài
                                                        khoản:</label>
                                                    <input type="text" class="form-control"
                                                           placeholder="Nhập tên tài khoản"
                                                           th:field="*{tenTaiKhoan}" 
                                                           oninput="validateKhachHangInput(this, 'tenTaiKhoan')"
                                                           onblur="validateKhachHangInput(this, 'tenTaiKhoan')">
                                                    <span class="check-loi" th:errors="*{tenTaiKhoan}"></span>
                                                    <span class="check-loi" th:text="${checkTenTrung}"></span>
                                                    <span class="check-loi" id="tenTaiKhoanError" style="color: red; display: block;"></span>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">
                                                        <span class="dau-sao">*</span>Tên
                                                        khách
                                                        hàng:</label>
                                                    <input type="text" class="form-control"
                                                           placeholder="Nhập khách hàng"
                                                           th:field="*{hoVaTen}" 
                                                           oninput="validateKhachHangInput(this, 'hoVaTen')"
                                                           onblur="validateKhachHangInput(this, 'hoVaTen')">
                                                    <span class="check-loi" th:errors="*{hoVaTen}"></span>
                                                    <span class="check-loi" id="hoVaTenError" style="color: red; display: block;"></span>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">
                                                        <span class="dau-sao">*</span>Ngày
                                                        sinh:</label>
                                                    <input type="date" class="form-control"
                                                           th:field="*{ngaySinh}"
                                                           oninput="validateNgaySinh(this)"
                                                           onchange="validateNgaySinh(this)">
                                                    <span class="check-loi" th:errors="*{ngaySinh}"></span>
                                                    <span class="check-loi" id="ngaySinhError" style="color: red; display: block;"></span>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">
                                                        <span class="dau-sao">*</span>Số
                                                        điện
                                                        thoại:</label>
                                                    <input type="text" class="form-control"
                                                           placeholder="Nhập số điện thoại"
                                                           th:field="*{soDienThoai}"
                                                           oninput="validateSoDienThoai(this)"
                                                           onblur="validateSoDienThoai(this)"
                                                           onkeypress="return onlyNumbers(event)">
                                                    <span class="check-loi" th:errors="*{soDienThoai}"></span>
                                                    <span class="check-loi" id="soDienThoaiError" style="color: red; display: block;"></span>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">
                                                        <span class="dau-sao">*</span>Email:</label>
                                                    <input type="email" class="form-control"
                                                           placeholder="Nhập email"
                                                           th:field="*{email}" 
                                                           name="email"
                                                           oninput="validateEmail(this)"
                                                           onblur="validateEmail(this)">
                                                    <span class="check-loi" th:errors="*{email}"></span>
                                                    <span class="check-loi" id="emailError" style="color: red; display: block;"></span>
                                                </div>

                                                <div class="modal-footer">
                                                    <button type="button"
                                                            class="btn btn-secondary"
                                                            data-bs-dismiss="modal">
                                                        Đóng
                                                    </button>
                                                    <button type="submit"
                                                            class="btn btn-success">Thêm
                                                    </button>
                                                </div>
                                            </form>
                                            <!-- form thêm khách hàng end-->

                                        </div>

                                    </div>
                                </div>
                            </div>
                            <!-- Modal end-->
                            <!-- Thông tin khách hàng -->
                            <div>
                                <div class="row mb-3">
                                    <label class="col-sm-2">Tên khách hàng:</label>
                                    <div class="col-sm-6">
                                        <label class="thong-tin-tai-khoan"
                                               th:text="${hoaDon.taiKhoan.hoVaTen}"></label>
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <label class="col-sm-2">Số điện thoại:</label>
                                    <div class="col-sm-6">
                                        <label class="thong-tin-tai-khoan"
                                               th:text="${hoaDon.taiKhoan.soDienThoai}"></label>
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <label class="col-sm-2">Email:</label>
                                    <div class="col-sm-6">
                                        <label class="thong-tin-tai-khoan"
                                               th:text="${hoaDon.taiKhoan.email}"></label>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <div class="line"></div>

                        <!------------------ model chọn địa chỉ ------------------>
                        <div class="row g-3" style=" margin-bottom: 2%;">

                            <!-- Button trigger modal -->

                            <div class="col-sm-12">
                                <button th:disabled="${hoaDon.taiKhoan.tenTaiKhoan==null}"
                                        th:if="${hoaDon.trangThai!=2&&hoaDon.trangThai!=3&&hoaDon.trangThai!=5}"
                                        id="checkBtnGiaoHang" type="button"
                                        class="btn btn-primary" data-bs-toggle="modal"
                                        style="float: right;" data-bs-target="#chonDiaChiModal">
                                    Chọn địa chỉ
                                </button>
                            </div>

                            <!-- Modal -->
                            <div class="modal fade modal-lg" id="chonDiaChiModal" tabindex="-1"
                                 aria-labelledby="chonDiaChiModalLabel" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h1 class="modal-title fs-5"
                                                id="chonDiaChiModalLabel">
                                                Danh sách
                                                địa chỉ
                                            </h1>
                                        </div>
                                        <div class="modal-body">


                                            <!-- table DC -->
                                            <table id="example2" class="display">
                                                <thead>
                                                <tr>
                                                    <th scope="col">STT</th>
                                                    <th scope="col">Phường/Xã</th>
                                                    <th scope="col">Quận/Huyện</th>
                                                    <th scope="col">Thành phố</th>
                                                    <th scope="col">Địa chỉ cụ thể</th>
                                                    <th scope="col">Hành Động</th>
                                                </tr>
                                                <thead>
                                                <tbody>

                                                <tr th:each="dc,state : ${lstTaiKhoanDc.lstDiaChi}"
                                                    class="diaChiRow">
                                                    <form
                                                            action="/ban-hang-tai-quay/hoa-don/add-dia-chi"
                                                            method="post">
                                                        <td
                                                                th:text="${state.index+1}">
                                                        </td>
                                                        <td class="phuongXaColumn">
                                                        </td>
                                                        <td class="quanHuyenColumn">
                                                        </td>
                                                        <td class="thanhPhoColumn">
                                                        </td>
                                                        <td
                                                                th:text="${dc.diaChiCuThe}">

                                                        </td>

                                                        <!-- <td class="trangthainkd">Phụ</td> -->
                                                        <td>
                                                            <button type="submit"
                                                                    class="btn btn-success">
                                                                Chọn
                                                            </button>
                                                        </td>
                                                        <td><input type="hidden"
                                                                   name="idDiaChi"
                                                                   th:value="${dc.id}">
                                                            <input type="hidden"
                                                                   name="idhdc"
                                                                   th:value="${hoaDon.id}">
                                                        </td>
                                                    </form>
                                                </tr>

                                                </tbody>
                                                <tfoot hidden="hidden">
                                                <tr>

                                                    <th scope="col">STT</th>
                                                    <th scope="col">Phường/Xã</th>
                                                    <th scope="col">Quận/Huyện</th>
                                                    <th scope="col">Thành phố</th>
                                                    <th scope="col">Địa chỉ cụ thể</th>
                                                    <th scope="col">Hành Động</th>

                                                </tr>
                                                </tfoot>
                                            </table>
                                            <!-- detail api địa chỉ lẻn bảng-->
                                            <script th:inline="javascript">

                                                document.addEventListener('DOMContentLoaded', function () {
                                                    console.log("thanhPho")
                                                    fetch('https://online-gateway.ghn.vn/shiip/public-api/master-data/province', {
                                                        method: 'GET',
                                                        headers: {
                                                            'token': 'd900c67f-742d-11ee-96dc-de6f804954c9',
                                                            'Content-Type': 'application/json',
                                                        },
                                                    })
                                                        .then(response => response.json())
                                                        .then(data => {
                                                            // Lấy giá trị id thành phố từ thymeleaf
                                                            var idThanhPhoArray = /*[[ ${lstTaiKhoanDc.lstDiaChi.![thanhPho] }]]*/[];
                                                            console.log("thanhPho1")
                                                            // Duyệt qua mỗi dòng trong bảng
                                                            document.querySelectorAll('.diaChiRow').forEach((row, index) => {
                                                                // Lấy id thành phố cho dòng hiện tại
                                                                var idThanhPho = idThanhPhoArray[index];

                                                                // Tìm thành phố trong data.data dựa trên id
                                                                var thanhPho = data.data.find(city => city.ProvinceID == idThanhPho);
                                                                console.log(thanhPho.ProvinceName)
                                                                console.log("thanhPho")
                                                                // Đặt tên thành phố vào thẻ có class là thanhPhoColumn trong dòng hiện tại
                                                                var thanhPhoColumn = row.querySelector('.thanhPhoColumn');
                                                                if (thanhPhoColumn && thanhPho) {
                                                                    thanhPhoColumn.innerText = thanhPho.ProvinceName;
                                                                }
                                                            });
                                                        })
                                                        .catch(error => {
                                                            console.error('Lỗi khi tải dữ liệu thành phố:', error);
                                                        });

                                                    // Hàm để tải và populate quận/huyện
                                                    fetch(`https://online-gateway.ghn.vn/shiip/public-api/master-data/district`, {
                                                        method: 'GET',
                                                        headers: {
                                                            'token': 'd900c67f-742d-11ee-96dc-de6f804954c9',
                                                            'Content-Type': 'application/json',
                                                        },
                                                    })
                                                        .then(response => response.json())
                                                        .then(data => {
                                                            // Lấy giá trị id thành phố từ thymeleaf
                                                            var idQuanHuyenArray = /*[[ ${lstTaiKhoanDc.lstDiaChi.![quanHuyen] }]]*/[];
                                                            // Duyệt qua mỗi dòng trong bảng
                                                            document.querySelectorAll('.diaChiRow').forEach((row, index) => {
                                                                // Lấy id thành phố cho dòng hiện tại
                                                                var idQuanHuyen = idQuanHuyenArray[index];

                                                                // Tìm thành phố trong data.data dựa trên id
                                                                var quanHuyen = data.data.find(district => district.DistrictID == idQuanHuyen);

                                                                // Đặt tên thành phố vào thẻ có class là quanHuyenColumn trong dòng hiện tại
                                                                var quanHuyenColumn = row.querySelector('.quanHuyenColumn');
                                                                if (quanHuyenColumn && quanHuyen) {
                                                                    quanHuyenColumn.innerText = quanHuyen.DistrictName;
                                                                }
                                                            });
                                                        })
                                                        .catch(error => {
                                                            console.error('Lỗi khi tải dữ liệu quận:', error);
                                                        });


                                                    // Lấy danh sách id quận/huyện từ một danh sách district
                                                    var idQuanHuyenArray = /*[[ ${lstTaiKhoanDc.lstDiaChi.![quanHuyen] }]]*/[];
                                                    // Lặp qua từng id quận/huyện và gọi API cho mỗi id
                                                    idQuanHuyenArray.forEach(idQuanHuyen => {
                                                        fetch(`https://online-gateway.ghn.vn/shiip/public-api/master-data/ward?district_id=${idQuanHuyen}`, {
                                                            method: 'GET',
                                                            headers: {
                                                                'token': 'd900c67f-742d-11ee-96dc-de6f804954c9',
                                                                'Content-Type': 'application/json',
                                                            },
                                                        })
                                                            .then(response => response.json())
                                                            .then(data => {
                                                                // Lấy giá trị id thành phố từ thymeleaf
                                                                var idPhuongXaArray = /*[[ ${lstTaiKhoanDc.lstDiaChi.![phuongXa] }]]*/[];
                                                                // Duyệt qua mỗi dòng trong bảng
                                                                document.querySelectorAll('.diaChiRow').forEach((row, index) => {
                                                                    // Lấy id thành phố cho dòng hiện tại
                                                                    var idPhuongXa = idPhuongXaArray[index];

                                                                    // Tìm thành phố trong data.data dựa trên id
                                                                    var phuongXa = data.data.find(ward => ward.WardCode == idPhuongXa);
                                                                    console.log(phuongXa)

                                                                    // Đặt tên thành phố vào thẻ có class là phuongXaColumn trong dòng hiện tại
                                                                    var phuongXaColumn = row.querySelector('.phuongXaColumn');
                                                                    if (phuongXaColumn && phuongXa) {
                                                                        phuongXaColumn.innerText = phuongXa.WardName;
                                                                    }

                                                                });
                                                            })
                                                            .catch(error => {
                                                                console.error('Lỗi khi tải dữ liệu xã:', error);
                                                            });
                                                    });
                                                });

                                            </script>
                                            <!-- detail api địa chỉ end-->

                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary"
                                                    data-bs-dismiss="modal">Đóng
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <form onsubmit="return validateThanhToan()"
                              action="/ban-hang-tai-quay/hoa-don/thanh-toan" class="row g-3"
                              method="post">
                            <input type="hidden" th:value="${hoaDon.id}" name="idhdc">
                            <div class="col">
                                <div id="checkGiaoHang" class="thong-tin-kh ">
                                    <div class="row g-3">
                                        <h4 style="font-family: Arial, sans-serif;font-size: 15px;
                                                        font-weight: bold;
                                                        color: black;">Thông tin giao hàng</h4>

                                        <div class="col-md-6">
                                            <label for="inputEmail2" class="form-label">
                                                <span class="dau-sao">*</span>
                                                Tên khách hàng:
                                            </label>
                                            <input type="text" class="form-control"
                                                   id="inputHoVaTen" name="inputHoVaTen"
                                                   th:value="${hoaDon.nguoiNhan}">
                                            <span class="errorInput"
                                                  id="errorInputHoVaTen"></span>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="inputPassword3" class="form-label">
                                                <span class="dau-sao">*</span>
                                                Số điện thoại:
                                            </label>
                                            <input type="text" class="form-control"
                                                   id="inputSoDienThoai"
                                                   name="inputSoDienThoai"
                                                   th:value="${hoaDon.sdtNguoiNhan}">
                                            <span class="errorInput"
                                                  id="errorInputSoDienThoai"></span>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">
                                                <span class="dau-sao">*</span>
                                                Địa chỉ:
                                            </label>

                                            <select id="citySelect" class="form-control"
                                                    name="thanhPho">
                                                <option value="" disabled selected>Chọn
                                                    Thành
                                                    Phố
                                                </option>
                                                <!-- Options will be filled dynamically here -->
                                            </select>
                                            <span class="errorInput"
                                                  id="errorCitySelect"></span>
                                            <br>
                                            <select id="districtSelect" class="form-control"
                                                    name="quanHuyen">
                                                <option value="" disabled selected>Chọn
                                                    Quận/Huyện
                                                </option>
                                                <!-- Options will be filled dynamically here -->
                                            </select>
                                            <span class="errorInput"
                                                  id="errorDistrictSelect"></span>

                                            <br>
                                            <select id="wardSelect" class="form-control"
                                                    name="phuongXa"
                                                    onchange="calculateShippingFee()">
                                                <option value="" disabled selected>Chọn
                                                    Phường /
                                                    Xã
                                                </option>
                                                <!-- Options will be filled dynamically here -->
                                            </select>
                                            <span class="errorInput"
                                                  id="errorWardSelect"></span>
                                            <!-- phishipjs -->
                                            <script th:inline="javascript">
                                                document.addEventListener('DOMContentLoaded', function () {
                                                    var citySelect = document.getElementById('citySelect');
                                                    var districtSelect = document.getElementById('districtSelect');
                                                    var wardSelect = document.getElementById('wardSelect');
                                                    console.log(citySelect)
                                                    console.log(districtSelect)
                                                    console.log(wardSelect)
                                                    var selectedCityValue = /*[[ ${hoaDon.thanhPho} ]]*/ '';
                                                    var selectedDistrictValue = /*[[ ${hoaDon.quanHuyen} ]]*/ '';
                                                    var selectedWardValue = /*[[ ${hoaDon.phuongXa} ]]*/ '';

                                                    fetch('https://online-gateway.ghn.vn/shiip/public-api/master-data/province', {
                                                        method: 'GET',
                                                        headers: {
                                                            'token': 'd900c67f-742d-11ee-96dc-de6f804954c9',
                                                            'Content-Type': 'application/json',
                                                        },
                                                    })
                                                        .then(response => response.json())
                                                        .then(data => {
                                                            // Xử lý dữ liệu khi API trả về thành công
                                                            populateSelect(citySelect, data.data, 'ProvinceID', 'ProvinceName');

                                                            // Tìm option có giá trị là selectedCityValue và đặt nó làm được chọn
                                                            var selectedOption = citySelect.querySelector(`option[value="${selectedCityValue}"]`);
                                                            if (selectedOption) {
                                                                selectedOption.selected = true;
                                                                // Kiểm tra nếu giá trị thành phố đã được chọn
                                                                if (selectedCityValue) {
                                                                    // Gọi hàm để tải và populate quận/huyện dựa trên ID của thành phố
                                                                    populateDistricts(selectedCityValue);
                                                                }
                                                            }

                                                        })
                                                        .catch(error => {
                                                            console.error('Lỗi khi tải dữ liệu thành phố:', error);
                                                        });

                                                    // Sự kiện khi chọn thành phố
                                                    citySelect.addEventListener('change', function () {
                                                        // Lấy ID của thành phố đã chọn
                                                        var selectedCityId = this.value;

                                                        console.log(selectedCityId);
                                                        // Kiểm tra nếu giá trị thành phố đã được chọn
                                                        if (selectedCityId) {
                                                            // Xóa hết các quận/huyện hiện tại trước khi tải mới
                                                            districtSelect.innerHTML = '<option value="">Chọn Quận/Huyện</option>';
                                                            // Gọi hàm để tải và populate quận/huyện dựa trên ID của thành phố
                                                            populateDistricts(selectedCityId);
                                                        }
                                                    });

                                                    // Sự kiện khi chọn thành phố
                                                    districtSelect.addEventListener('change', function () {
                                                        // Lấy ID của thành phố đã chọn
                                                        var selectedDistrictId = this.value;

                                                        console.log(selectedDistrictId);
                                                        // Kiểm tra nếu giá trị thành phố đã được chọn
                                                        if (selectedDistrictId) {
                                                            // Xóa hết các quận/huyện hiện tại trước khi tải mới
                                                            wardSelect.innerHTML = '<option value="">Chọn Phường / Xã</option>';
                                                            // Gọi hàm để tải và populate quận/huyện dựa trên ID của thành phố
                                                            populateWard(selectedDistrictId);
                                                        }
                                                    });

                                                    // Hàm để tải và populate quận/huyện
                                                    function populateDistricts(selectedCityId) {
                                                        fetch(`https://online-gateway.ghn.vn/shiip/public-api/master-data/district?province_id=${selectedCityId}`, {
                                                            method: 'GET',
                                                            headers: {
                                                                'token': 'd900c67f-742d-11ee-96dc-de6f804954c9',
                                                                'Content-Type': 'application/json',
                                                            },
                                                        })
                                                            .then(response => response.json())
                                                            .then(data => {
                                                                // Xử lý dữ liệu khi API trả về thành công
                                                                populateSelect(districtSelect, data.data, 'DistrictID', 'DistrictName');

                                                                // Tìm option có giá trị là selectedCityValue và đặt nó làm được chọn
                                                                var selectedOption = districtSelect.querySelector(`option[value="${selectedDistrictValue}"]`);
                                                                if (selectedOption) {
                                                                    selectedOption.selected = true;
                                                                    // Kiểm tra nếu giá trị thành phố đã được chọn
                                                                    if (selectedDistrictValue) {
                                                                        // Gọi hàm để tải và populate quận/huyện dựa trên ID của thành phố
                                                                        populateWard(selectedDistrictValue);
                                                                    }
                                                                }

                                                            })
                                                            .catch(error => {
                                                                console.error('Lỗi khi tải dữ liệu quận:', error);
                                                            });
                                                    }

                                                    // Hàm để tải và populate xã phường
                                                    function populateWard(selectedDistrictId) {
                                                        fetch(`https://online-gateway.ghn.vn/shiip/public-api/master-data/ward?district_id=${selectedDistrictId}`, {
                                                            method: 'GET',
                                                            headers: {
                                                                'token': 'd900c67f-742d-11ee-96dc-de6f804954c9',
                                                                'Content-Type': 'application/json',
                                                            },
                                                        })
                                                            .then(response => response.json())
                                                            .then(data => {
                                                                // Xử lý dữ liệu khi API trả về thành công
                                                                populateSelect(wardSelect, data.data, 'WardCode', 'WardName');

                                                                // Tìm option có giá trị là selectedCityValue và đặt nó làm được chọn
                                                                var selectedOption = wardSelect.querySelector(`option[value="${selectedWardValue}"]`);
                                                                if (selectedOption) {
                                                                    selectedOption.selected = true;
                                                                    // Kiểm tra nếu giá trị thành phố đã được chọn
                                                                    // if (selectedWardValue) {
                                                                    //     // Gọi hàm để tải và populate quận/huyện dựa trên ID của thành phố
                                                                    //     populateWard(selectedWardValue);
                                                                    // }
                                                                }

                                                            })
                                                            .catch(error => {
                                                                console.error('Lỗi khi tải dữ liệu quận:', error);
                                                            });
                                                    }

                                                    // Hàm để populate dropdown
                                                    function populateSelect(select, data, idKey, textKey) {
                                                        // select.innerHTML = '<option value="">Chọn thành phố</option>';
                                                        data.forEach(item => {
                                                            var option = document.createElement('option');
                                                            option.value = item[idKey];
                                                            option.text = item[textKey];
                                                            select.appendChild(option);
                                                        });
                                                    }
                                                });

                                                // giao hàng nhanh
                                                function calculateShippingFee() {
                                                    var citySelect = document.getElementById('citySelect').value;
                                                    var districtSelect = document.getElementById('districtSelect').value;
                                                    var wardSelect = document.getElementById('wardSelect').value;
                                                    const shippingInfo = {
                                                        service_type_id: 2,
                                                        from_district_id: 3440,
                                                        to_district_id: Number(districtSelect),
                                                        to_ward_code: wardSelect,
                                                        height: 10,
                                                        length: 10,
                                                        weight: 500,
                                                        width: 10,
                                                        insurance_value: 0,
                                                        coupon: null,
                                                        items: [
                                                            {
                                                                "name": "TEST1",
                                                                "quantity": 1,
                                                                "height": 20,
                                                                "weight": 1,
                                                                "length": 20,
                                                                "width": 20
                                                            }
                                                        ]
                                                    };

                                                    fetch('https://online-gateway.ghn.vn/shiip/public-api/v2/shipping-order/fee', {
                                                        method: 'POST',
                                                        headers: {
                                                            'Content-Type': 'application/json',
                                                            'Token': '0c4a5894-7fc8-11ee-96dc-de6f804954c9',
                                                        },
                                                        body: JSON.stringify(shippingInfo)
                                                    })
                                                    .then(response => response.json())
                                                    .then(data => {
                                                        const shippingFeeResult = document.getElementById('shippingFeeResult');
                                                        const shippingFeeResult2 = document.getElementById('phi-van-chuyen');
                                                        const phiShipInput = document.getElementById('shippingFeeResult');
                                                        const tongGiaElement = document.querySelector('.tong-gia');
                                                        const shippingFeeResultInput = document.getElementById('shippingFeeResult');
                                                        const tongTienHoaDonInput = document.querySelector('input[name="tongTienHoaDon"]');
                                                        const tongGiaValue = document.getElementById('tongGiaValue');
                                                        const tongAll = document.getElementById('tongAll');
                                                        const giamGia = document.getElementById('giamGiaInput');

                                                        // Format the shipping fee with thousands separators
                                                        const formattedShippingFee = data.data.total.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
                                                        shippingFeeResult.value = data.data.total;
                                                        shippingFeeResult2.innerHTML = formattedShippingFee + ' VND';

                                                        function congHaiInputVaCapNhatTongGia() {
                                                            const tongTienHoaDon = parseFloat(tongTienHoaDonInput.value);
                                                            const shippingFee = parseFloat(shippingFeeResultInput.value);
                                                            const giamGia1 = isNaN(parseFloat(giamGia.value)) ? 0 : parseFloat(giamGia.value);
                                                            const phiShip = isNaN(shippingFee) ? 0 : shippingFee;
                                                            const tongGia = tongTienHoaDon + phiShip - giamGia1;

                                                            // Format the total with thousands separators
                                                            const formattedTotal = tongGia.toFixed(0).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
                                                            tongGiaValue.textContent = formattedTotal + ' VND';
                                                            tongAll.value = tongGia.toFixed(0);
                                                        }

                                                        shippingFeeResultInput.addEventListener('input', congHaiInputVaCapNhatTongGia);
                                                        tongTienHoaDonInput.addEventListener('input', congHaiInputVaCapNhatTongGia);
                                                        congHaiInputVaCapNhatTongGia();
                                                    })
                                                    .catch(error => console.error('Error:', error));
                                                }
                                            </script>

                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">
                                                <span class="dau-sao">*</span>
                                                Địa chỉ cụ thể:
                                            </label>
                                            <textarea name="inputDcct" id="inputDiaChiCuThe"
                                                      class="form-control"
                                                      rows="6">[[${hoaDon.diaChiNguoiNhan}]]</textarea>
                                            <span class="errorInput"
                                                  id="errorInputDiaChiCuThe"></span>
                                        </div>

                                        <div class="col-12">
                                            <label class="form-label">
                                                <span class="dau-sao">*</span>
                                                Ghi chú:
                                            </label>
                                            <textarea name="inputGhiChu" id="inputGhiChu"
                                                      class="form-control"
                                                      rows="3">[[${hoaDon.ghiChu}]]</textarea>
                                        </div>
                                        <!-- <span th:text="${hoaDon.TaiKhoan.tenTaiKhoan!=null}"></span> -->
                                        <div th:if="${#lists.size(lstTaiKhoanDc.lstDiaChi) <5&&hoaDon.taiKhoan.tenTaiKhoan!=null}"
                                             class="row">
                                            <!-- [[${#lists.size(lstTaiKhoanDc.lstDiaChi)}]] -->
                                            <div class="col" style="margin-top: 3%;">

                                                <div class="form-check form-switch">
                                                    Lưu địa chỉ
                                                    <input class="form-check-input"
                                                           type="checkbox" role="switch"
                                                           name="luuDiaChi">

                                                </div>
                                            </div>


                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col">
                                <div class="thong-tin-tt">
                                    <h4 style="font-family: Arial, sans-serif;font-size: 15px;
                                                            font-weight: bold;
                                                                color: black;">Thông tin thanh toán</h4>
                                    <div class="thong-tin-tt-2">
                                        <div class="row">
                                            <div class="col">
                                                <h6>Giao hàng:</h6>
                                            </div>
                                            <div class="col" style="margin-top: 3%;">
                                                <div class="form-check form-switch">
                                                    <input class="form-check-input"
                                                           type="checkbox" role="switch"
                                                           id="toggleVisibility"
                                                           name="giaoHang">
                                                    <script>
                                                        const toggleVisibility = document.getElementById('toggleVisibility');
                                                        // if('[[${hoaDon.phiShip}]]'==0&&'[[${hoaDon.trangThai}]]==3'){
                                                        //     toggleVisibility.disabled=true
                                                        // }

                                                        if ('[[${hoaDon.phuongXa}]]' == "") {
                                                            toggleVisibility.checked = false;
                                                            document.getElementById('checkGiaoHang').style.display = 'none'
                                                            document.getElementById('checkBtnGiaoHang').style.display = 'none'
                                                        } else {
                                                            setTimeout(function () {
                                                                calculateShippingFee();
                                                            }, 2000);
                                                            toggleVisibility.checked = true;

                                                        }

                                                        function setDefaultPhiShip() {
                                                            var gg = document.getElementById('giamGiaInput').value
                                                            var TongTienHoaDon = Number('[[${hoaDon.tongTienHoaDon()}]]');
                                                            document.getElementById('shippingFeeResult').value = 0;
                                                            document.getElementById('tongAll').value = TongTienHoaDon - gg;
                                                            document.getElementById('phi-van-chuyen').innerHTML = '0 VND';

                                                            document.getElementById('tongGiaValue').innerHTML = TongTienHoaDon - gg;
                                                        }

                                                        toggleVisibility.addEventListener('change', function () {
                                                            const checkGiaoHang = document.getElementById('checkGiaoHang')
                                                            if (this.checked) {

                                                                console.log('Checkbox is checked');
                                                                calculateShippingFee();
                                                                // congHaiInputVaCapNhatTongGia();
                                                                checkGiaoHang.style.display = 'block';
                                                                checkBtnGiaoHang.style.display = 'block';
                                                            } else {
                                                                setDefaultPhiShip();
                                                                // congHaiInputVaCapNhatTongGia();
                                                                console.log('Checkbox is unchecked');
                                                                checkGiaoHang.style.display = 'none';
                                                                checkBtnGiaoHang.style.display = 'none';

                                                            }
                                                        });
                                                    </script>
                                                </div>
                                            </div>



                                        <div class="row">
                                            <div class="col">
                                                <h6>Voucher:</h6>
                                            </div>
                                            <div class="col" style="margin-top: 1%">
                                                <div class="input-group flex-nowrap">
                                                    <input type="text" class="form-control"
                                                           id="c_code" disabled
                                                           aria-label="Coupon Code"
                                                           aria-describedby="button-addon2"/>
                                                    <button

                                                            class="btn btn-primary btn-sm"
                                                            type="button"
                                                            onclick="checkAndDisplayVouchers()"
                                                            data-bs-toggle="modal"
                                                            data-bs-target="#voucher">
                                                        Chọn voucher
                                                    </button>
                                                    <!-- Modal -->
                                                    <div class="modal fade modal-lg" id="voucher"
                                                         tabindex="-1"
                                                         aria-labelledby="voucherLabel"
                                                         aria-hidden="true">
                                                        <div class="modal-dialog">
                                                            <div class="modal-content">
                                                                <div class="modal-header">
                                                                    <h3 class="modal-title fs-5"
                                                                        style="margin: auto"
                                                                        id="voucherLabel">
                                                                        Chọn
                                                                        Voucher
                                                                    </h3>
                                                                </div>
                                                                <div class="modal-body">
                                                                    <div class="card mb-3"
                                                                         style="height: 10%"
                                                                         th:each="voucher : ${listVoucher}">
                                                                        <div
                                                                                class="row g-0">
                                                                            <div
                                                                                    class="col-md-3">
                                                                                <div class="card-body"
                                                                                     style="margin-left: 5px;margin-top: 15px">
                                                                                    <img src="../../static/img/logo_teehaven.png"
                                                                                         style="margin-left: 15px"
                                                                                         class="img-fluid rounded-start"
                                                                                         alt="...">
                                                                                </div>
                                                                            </div>
                                                                            <div
                                                                                    class="col-md-7">
                                                                                <div
                                                                                        class="card-body">
                                                                                    <h5 class="card-title"
                                                                                        style="margin-bottom: -3px"
                                                                                        th:text="${'Giảm '+ voucher.phanTramGiam + '%'}">
                                                                                    </h5>
                                                                                    <small
                                                                                            class="text-body-secondary"
                                                                                            style="display: block"
                                                                                            th:text="${'Giảm tối đa '+#numbers.formatDecimal(voucher.giamToiDa, 0, 'POINT', 0, 'POINT') + ' VNĐ'}"></small>
                                                                                    <small class="text-body-secondary donToiThieu"
                                                                                           th:text="${'Đơn Tối Thiểu '+#numbers.formatDecimal(voucher.giaTriDonToiThieu, 0, 'POINT', 0, 'POINT') + ' VNĐ'}">
                                                                                    </small>

                                                                                    <small
                                                                                            class="text-body-secondary"
                                                                                            style="display: block"
                                                                                            th:text="${'Số Lượng '+voucher.soLuong}"></small>
                                                                                    <small
                                                                                            class="text-body-secondary"
                                                                                            style="display: block"
                                                                                            th:text="${#temporals.format(voucher.ngayKetThuc, 'HH:mm dd/MM/yyyy')}"></small>
                                                                                </div>
                                                                            </div>
                                                                            <div
                                                                                    class="col-md-2">
                                                                                <div
                                                                                        class="card-body">
                                                                                    <input
                                                                                            type="radio"
                                                                                            style="margin-top: 35px"
                                                                                            name="voucherRadio"
                                                                                            th:data-index="${voucher.id + ' ' +voucher.phanTramGiam+ ' ' +voucher.giamToiDa}"
                                                                                            onchange="handleRadioVoucher(this)">

                                                                                </div>
                                                                            </div>
                                                                            <div
                                                                                    class="col-md-12">
                                                                                <small class="text-body-secondary thongBaoThieuTien" style="display: none; color: red;"></small>

                                                                            </div>
                                                                        </div>
                                                                    </div>


                                                                </div>
                                                                <div class="modal-footer">
                                                                    <button type="button"
                                                                            onclick="boChonVoucher()"
                                                                            class="btn btn-secondary"
                                                                            data-bs-dismiss="modal">
                                                                        Bỏ
                                                                        chọn
                                                                    </button>
                                                                    <button type="button"
                                                                            class="btn btn-secondary"
                                                                            data-bs-dismiss="modal">
                                                                        Quay
                                                                        lại
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col">
                                                <h6>Tổng tiền sản phẩm:</h6>
                                            </div>
                                            <div class="col">
                                                <h6 id="totalAmount" class="thong-tin-gia">
                                                    [[${#numbers.formatDecimal(hoaDon.tongTienHoaDon(), 0, 'POINT', 0, 'POINT') + ' VNĐ'}]]
                                                </h6>
                                                <input th:value="${hoaDon.tongTienHoaDon()}"
                                                       type="hidden" name="tongTienHoaDon">
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col">
                                                <h6>Phí vận chuyển:</h6>
                                            </div>
                                            <div class="col">
                                                <h6 id="phi-van-chuyen"
                                                    class="thong-tin-gia">


                                                    [[${#numbers.formatDecimal(hoaDon.phiShip, 0, 'POINT', 0, 'POINT') + ' VNĐ'}]]

                                                </h6>


                                                <input th:value="${hoaDon.phiShip}"
                                                       name="phiShip" type="hidden"
                                                       id="shippingFeeResult">
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col">
                                                <h6>Giảm giá:</h6>

                                                <input id="giamGiaInput" type="hidden"
                                                       th:value="${hoaDon.tongTien}-${hoaDon.tongTienKhiGiam}"
                                                       name="giamGia">
                                            </div>
                                            <div class="col">
                                                <h6 id="moneyVoucher" class="thong-tin-gia">
                                                    [[${#numbers.formatDecimal(hoaDon.tongTien, 0, 'POINT', 0, 'POINT')}-${#numbers.formatDecimal(hoaDon.tongTienKhiGiam, 0, 'POINT', 0, 'POINT')}]]
                                                    VNĐ
                                                </h6>
                                            </div>
                                        </div>

                                        <div th:if="${hoaDon.trangThai==-1||hoaDon.trangThai==4}"
                                             class="row">
                                            <div class="col">
                                                <h6>Tiền khách trả:</h6>
                                            </div>
                                            <div class="col">

                                                <input cla id="tienKhachTra"
                                                       class="thong-tin-gia form-control"
                                                       type="number">
                                            </div>


                                        </div>
                                        <div th:if="${hoaDon.trangThai==-1||hoaDon.trangThai==4}"
                                             class="row">
                                            <div class="col">
                                                <h6>Trả lại:</h6>
                                            </div>
                                            <div class="col">

                                                <h6 class="thong-tin-gia"><span
                                                        id="traLai">0</span>
                                                    VNĐ</h6>
                                            </div>


                                        </div>
                                        <div class="row">
                                            <div class="col">
                                                <h3>Tổng tiền:</h3>
                                            </div>
                                            <div class="col">
                                                <h6 class="thong-tin-gia" id="tongGiaH6">
                                                                                <span
                                                                                        id="tongGiaValue">[[${#numbers.formatDecimal(hoaDon.tongTienHoaDonKhiGiam(), 0, 'POINT', 0, 'POINT') + ' VNĐ'}]]</span>
                                                </h6>
                                                <input
                                                        th:value="${hoaDon.tongTienHoaDonKhiGiam()}"
                                                        type="hidden" id="tongAll">
                                            </div>


                                        </div>

                                    </div>
                                </div>
                            </div>

                            <div th:switch="${hoaDon.trangThai}">

                                <div th:case="-1" class="" style="float: right;">


                                    <button
                                            th:if="${#lists.size(hoaDon.lstHoaDonChiTiet) ==0}"
                                            type="button" class="btn btn-success"
                                            data-bs-toggle="modal"
                                            data-bs-target="#gioHangTrong">
                                        Thanh toán
                                    </button>
                                    <button onclick="return validateThanhToan()"
                                            id="thanhToan"
                                            th:if="${#lists.size(hoaDon.lstHoaDonChiTiet) !=0}"
                                            type="button" class="btn btn-success">Thanh toán

                                    </button>
                                    <!-- Button trigger modal -->


                                    <!-- Modal -->
                                    <div class="modal fade modal-lg" id="gioHangTrong" tabindex="-1"
                                         role="dialog" aria-labelledby="modalTitleId"
                                         aria-hidden="true">
                                        <div class="modal-dialog" role="document">
                                            <div class="modal-content">

                                                <div class="modal-body">
                                                    <div style="text-align: center;"
                                                         class="container-fluid">
                                                        Không có sản phẩm vẫn cố thanh toán rất là bảo thủ
                                                        ?
                                                    </div>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button"
                                                            class="btn btn-secondary"
                                                            data-bs-dismiss="modal">Đóng
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>


                                </div>


                                <!-- Modal -->
                                <div class="modal fade modal-lg" id="ghiChuThanhToan" tabindex="-1"
                                     role="dialog" aria-labelledby="modalTitleId"
                                     aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="modalTitleId">
                                                    Xác
                                                    nhận</h5>

                                            </div>
                                            <div class="modal-body">
                                                <div class="container-fluid">
                                                    <div class="mb-3">
                                                        <label for="" class="form-label">Ghi
                                                            chú</label>
                                                        <textarea class="form-control"
                                                                  name="ghiChuThanhToan"
                                                                  id="nhapGhiChu" cols="30"
                                                                  rows="3"></textarea>

                                                        <small style="color: red;"
                                                               id="errorGhiChuThanhToan"
                                                               class="form-text "></small>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button"
                                                        class="btn btn-secondary"
                                                        data-bs-dismiss="modal">Đóng
                                                </button>
                                                <button type="submit"
                                                        class="btn btn-primary">Xác
                                                    nhận
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>


                                <button id="thanhToan" th:case="0" type="button"
                                        data-bs-toggle="modal" data-bs-target="#ghiChuThanhToan"
                                        style="float: right;" class="btn btn-success">Xác nhận
                                </button>
                                <button id="thanhToan" th:case="1" type="button"
                                        data-bs-toggle="modal" data-bs-target="#ghiChuThanhToan"
                                        style="float: right;" class="btn btn-success">Đang giao
                                </button>
                                <button id="thanhToan" th:case="2" type="button"
                                        data-bs-toggle="modal" data-bs-target="#ghiChuThanhToan"
                                        style="float: right;" class="btn btn-success">Hoàn thành
                                </button>
                                <button id="thanhToan" th:case="3" type="button"
                                        data-bs-toggle="modal" data-bs-target="#ghiChuThanhToan"
                                        style="float: right;" class="btn btn-success">Xác nhận
                                    trả
                                    hàng
                                </button>
                                <div th:case="6" class="">
                                    <!-- <button id="thanhToan"  type="button"
                                    data-bs-toggle="modal" data-bs-target="#ghiChuThanhToan"
                                    style="float: right;" class="btn btn-success">Từ chối
                                </button> -->
                                    <!--                                    <button id="thanhToan" type="button"-->
                                    <!--                                            data-bs-toggle="modal"-->
                                    <!--                                            data-bs-target="#ghiChuThanhToan"-->
                                    <!--                                            style="float: right;" class="btn btn-success">Xác-->
                                    <!--                                        nhận-->
                                    <!--                                        trả hàng-->
                                    <!--                                    </button>-->
                                </div>

                                <button id="thanhToan" th:case="4" type="button"
                                        data-bs-toggle="modal" data-bs-target="#ghiChuThanhToan"
                                        style="float: right;" class="btn btn-success">Thanh toán
                                </button>

                            </div>
                            <input value="" name="voucherID" type="hidden" id="voucherID">
                        </form>
                        <!-- Modal SP-->
                        <div class="modal fade" th:id="${'addsp'+hoaDon.id}" tabindex="-1"
                             aria-labelledby="themSanPhamLabel" aria-hidden="true">
                            <div class="modal-dialog modal-lg">
                                <div class="modal-content">
                                    <div class="modal-body">
                                        <!-- form search -->
                                        <div class="modal-header">
                                            <h1 class="modal-title fs-5" style="margin: auto;">
                                                Danh sách sản phẩm
                                            </h1>
                                        </div>
                                        <!-- Add filter section -->
                                        <div class="row mb-3" style="padding: 15px;">
                                            <div class="col-md-3">
                                                <label class="form-label">Tên sản phẩm:</label>
                                                <input type="text" class="form-control" id="filterTenSanPham" placeholder="Nhập tên sản phẩm" onkeypress="return validateInput(event)">
                                                <span class="text-danger" id="tenSanPhamError" style="font-size: 0.875em;"></span>
                                            </div>
                                            <div class="col-md-3">
                                                <label class="form-label">Màu sắc:</label>
                                                <select class="form-select" id="filterMauSac">
                                                    <option value="">Tất cả</option>
                                                    <option th:each="mau : ${#lists.sort(#sets.toSet(listCtsp.![mauSac.ten]))}" th:value="${mau}" th:text="${mau}"></option>
                                                </select>
                                            </div>
                                            <div class="col-md-3">
                                                <label class="form-label">Kích thước:</label>
                                                <select class="form-select" id="filterKichThuoc">
                                                    <option value="">Tất cả</option>
                                                    <option th:each="kich : ${#lists.sort(#sets.toSet(listCtsp.![kichCo.ten]))}" 
                                                            th:value="${kich}" 
                                                            th:text="${kich}">
                                                    </option>
                                                </select>
                                            </div>
                                            <div class="col-md-3">
                                                <label class="form-label">Tay áo:</label>
                                                <select class="form-select" id="filterTayAo">
                                                    <option value="">Tất cả</option>
                                                    <option th:each="tay : ${#lists.sort(#sets.toSet(listCtsp.![tayAo.ten]))}" th:value="${tay}" th:text="${tay}"></option>
                                                </select>
                                            </div>
                                            <div class="col-md-3">
                                                <label class="form-label">Giá từ:</label>
                                                <input type="text" class="form-control" id="filterGiaTu" placeholder="Nhập giá từ" onkeypress="return validateNumber(event)">
                                                <span class="text-danger" id="giaTuError" style="font-size: 0.875em;"></span>
                                            </div>
                                            <div class="col-md-3">
                                                <label class="form-label">Giá đến:</label>
                                                <input type="text" class="form-control" id="filterGiaDen" placeholder="Nhập giá đến" onkeypress="return validateNumber(event)">
                                                <span class="text-danger" id="giaDenError" style="font-size: 0.875em;"></span>
                                            </div>
                                        </div>
                                        <table id="example" class="display">
                                            <thead>
                                            <tr>
                                                <th scope="col">STT</th>
                                                <th scope="col">Sản Phẩm</th>
                                                <th scope="col">Số Lượng</th>
                                                <th scope="col">Giá Bán</th>
                                                <th scope="col">Hành Động</th>
                                            </tr>
                                            <thead>
                                            <tbody>
                                            <tr th:each=" ctsp, state: ${listCtsp}">
                                                <form
                                                        action="/ban-hang-tai-quay/hoa-don-chi-tiet/add"
                                                        method="post">
                                                    <!-- input hidden -->
                                                    <input th:value="${hoaDon.id}"
                                                           type="hidden" name="idHoaDon">
                                                    <input th:value="${ctsp.id}"
                                                           type="hidden" name="idCtsp">

                                                    <th scope="row" style="width: 5%;"
                                                        th:text="${state.index+1}"></th>
                                                    <td style="width: 50%;">
                                                        <div class="row">
                                                            <div class="col-4">
                                                                <div th:each="url : ${#strings.listSplit(ctsp.sanPham.hinhAnh, ',')[0]}"
                                                                     style="display: inline-block; margin-right: 5px;">
                                                                    <img th:src="${url}" alt="Hình ảnh sản phẩm"
                                                                         style="width: 100px; height: auto;"/>
                                                                </div>
                                                            </div>
                                                            <div class="col-8">
                                                                <div class="info-price">
                                                                    <h6>[[${ctsp.SanPham.ten}]]
                                                                        [
                                                                        [[${ctsp.MauSac.ten}]]
                                                                        -
                                                                        [[${ctsp.KichCo.ten}]]
                                                                        ]
                                                                    </h6>
                                                                    <span>Đơn giá: <span
                                                                            class="gia">
                                                                                                            [[${#numbers.formatDecimal(ctsp.giaHienHanh, 0, 'POINT', 0, 'POINT') + ' VNĐ'}]]
                                                                                                            </span></span>
                                                                    <p>Tay áo:
                                                                        [[${ctsp.TayAo.ten}]]
                                                                    </p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        [[${ctsp.soLuong}]]
                                                    </td>
                                                    <td>

                                                        [[${#numbers.formatDecimal(ctsp.giaHienHanh, 0, 'POINT', 0, 'POINT') + ' VNĐ'}]]

                                                    </td>
                                                    <td>

                                                        <button
                                                                th:id="'themSp'+${ctsp.id}"
                                                                type="submit"
                                                                class="btn btn-success">Thêm
                                                        </button>
                                                        <!-- th:onclick="'handleButtonClick(`themSp'+${ctsp.id}+'`)'"  -->
                                                    </td>
                                                </form>
                                            </tr>

                                            </tbody>
                                            <tfoot hidden="hidden">
                                            <tr>
                                                <th>STT</th>
                                                <th>Sản Phẩm</th>
                                                <th>Số Lượng</th>
                                                <th>Giá Bán</th>
                                                <th>Hành Động</th>
                                            </tr>
                                            </tfoot>
                                        </table>

                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary"
                                                data-bs-dismiss="modal">Đóng
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</main><!-- End #main -->


<!-- ======= Footer ======= -->
<footer id="footer" class="footer">
    <div class="copyright">

    </div>
    <div class="credits">
        Website bán áo Tee Haven
    </div>
</footer><!-- End Footer -->

<a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i
        class="bi bi-arrow-up-short"></i></a>

<div th:replace="~{admin-template/fragment/script :: script}"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.19/js/jquery.dataTables.js'></script>
<script>
    // Thêm các hàm validation
    function validateInput(event) {
        // Chỉ cho phép chữ cái, số và khoảng trắng
        var charCode = (event.which) ? event.which : event.keyCode;
        if (charCode > 31 && (charCode < 48 || charCode > 57) && (charCode < 65 || charCode > 90) && (charCode < 97 || charCode > 122) && charCode != 32) {
            event.preventDefault();
            return false;
        }
        return true;
    }

    function validateNumber(event) {
        // Chỉ cho phép số
        var charCode = (event.which) ? event.which : event.keyCode;
        if (charCode > 31 && (charCode < 48 || charCode > 57)) {
            event.preventDefault();
            return false;
        }
        return true;
    }


    $(document).ready(function () {
        var table = $('#example').DataTable({
            "language": {
                "info": "Hiển thị _START_ đến _END_ trong tổng số _TOTAL_ kết quả",
                "emptyTable": "Không có kết quả nào được tìm thấy",
                "zeroRecords": "Không có kết quả phù hợp",
                "infoEmpty": "Không có dữ liệu để hiển thị"
            },
            "initComplete": function (settings, json) {
                $('#example_filter').hide();
                $('#example_length label').contents().filter(function () {
                    return this.nodeType === 3;
                }).first().replaceWith('Hiển thị');
                $('#example_length label').contents().filter(function () {
                    return this.nodeType === 3;
                }).last().replaceWith('mục');

                $('#example_length select').addClass('form-select');
            }
        });

        // Add event listeners for all filter inputs
        $('#filterTenSanPham, #filterMauSac, #filterKichThuoc, #filterTayAo').on('change keyup', function() {
            applyFilters();
        });

        // Modified price input handlers with additional validation
        $('#filterGiaTu, #filterGiaDen').on('input', function(e) {
            this.value = this.value.replace(/[^\d]/g, '');
            validatePriceRange();
        });

        $('#filterTenSanPham').on('input', function(e) {
            this.value = this.value.replace(/[^a-zA-Z0-9\sÀ-ỹ]/g, '');
        });

        function validatePriceRange() {
            var giaTu = parseFloat($('#filterGiaTu').val()) || 0;
            var giaDen = parseFloat($('#filterGiaDen').val());
            var giaTuError = $('#giaTuError');
            var giaDenError = $('#giaDenError');
            var isValid = true;

            giaTuError.text('');
            giaDenError.text('');

            if (giaTu < 0) {
                giaTuError.text('Giá không được âm');
                isValid = false;
            }

            if (giaDen) {
                if (giaDen < 0) {
                    giaDenError.text('Giá không được âm');
                    isValid = false;
                } else if (giaDen < giaTu) {
                    giaDenError.text('Giá đến phải lớn hơn hoặc bằng giá từ');
                    isValid = false;
                }
            }

            if (isValid) {
                applyFilters();
            }
        }

        window.applyFilters = function() {
            var giaTu = parseFloat($('#filterGiaTu').val()) || 0;
            var giaDen = parseFloat($('#filterGiaDen').val());

            if (giaDen && giaDen < giaTu) {
                return;
            }

            table.draw();
        }

        // Sửa đổi hàm lọc tùy chỉnh
        $.fn.dataTable.ext.search.push(function(settings, data, dataIndex) {
            var tenSanPham = $('#filterTenSanPham').val().toLowerCase();
            var mauSac = $('#filterMauSac').val();
            var kichThuoc = $('#filterKichThuoc').val();
            var tayAo = $('#filterTayAo').val();
            var giaTu = parseFloat($('#filterGiaTu').val()) || 0;
            var giaDen = parseFloat($('#filterGiaDen').val()) || Number.MAX_VALUE;

            if (giaDen && giaDen < giaTu) {
                return true;
            }

            var rowData = $(table.row(dataIndex).node());
            var productName = data[1].toLowerCase();
            var price = parseFloat(data[3].replace(/[^\d]/g, ''));
            var productDetails = rowData.find('.info-price').text();

            var matchesName = !tenSanPham || productName.includes(tenSanPham);
            var matchesMauSac = !mauSac || (new RegExp('\\[\\s*' + mauSac + '\\s*-').test(productDetails));
            var matchesKichThuoc = !kichThuoc || (new RegExp('-\\s*' + kichThuoc + '\\s*\\]').test(productDetails));
            var matchesTayAo = !tayAo || (new RegExp('Tay áo:\\s*' + tayAo).test(productDetails));
            var matchesPrice = price >= giaTu && price <= giaDen;

            return matchesName && matchesMauSac && matchesKichThuoc && matchesTayAo && matchesPrice;
        });

        table.on('draw.dt', function () {
            var pageInfo = table.page.info();
            var newInfo = 'Hiển thị ' + pageInfo.start + ' đến ' + pageInfo.end + ' trong tổng số ' + pageInfo.recordsDisplay + ' kết quả';
            $('#example_info').html(newInfo);
        });
    });

    $(document).ready(function () {
        var table = $('#example1').DataTable({
            "language": {
                "info": "Hiển thị _START_ đến _END_ trong tổng số _TOTAL_ kết quả",
                "emptyTable": "Không có kết quả nào được tìm thấy",
                "zeroRecords": "Không có kết quả phù hợp",
                "infoEmpty": "Không có dữ liệu để hiển thị"
            },
            "initComplete": function (settings, json) {
                // CSS changes
                $('#example1_filter input[type="search"]').addClass('form-control');
                $('#example1_filter input[type="search"]').attr('placeholder', 'Tìm kiếm');
                $('#example1_filter label').contents().filter(function () {
                    return this.nodeType === 3;
                }).replaceWith(' ');

                $('#example1_length label').contents().filter(function () {
                    return this.nodeType === 3;
                }).first().replaceWith('Hiển thị');
                $('#example1_length label').contents().filter(function () {
                    return this.nodeType === 3;
                }).last().replaceWith('mục');

                $('#example1_length select').addClass('form-select');
            }
        });

        table.on('draw.dt', function () {
            var pageInfo = table.page.info();

            var newInfo = 'Hiển thị ' + pageInfo.start + ' đến ' + pageInfo.end + ' trong tổng số ' + pageInfo.recordsDisplay + ' kết quả';
            $('#example1_info').html(newInfo);

        });
    });

    $(document).ready(function () {
        var table = $('#example2').DataTable({
            "language": {
                "info": "Hiển thị _START_ đến _END_ trong tổng số _TOTAL_ kết quả",
                "emptyTable": "Không có kết quả nào được tìm thấy",
                "zeroRecords": "Không có kết quả phù hợp",
                "infoEmpty": "Không có dữ liệu để hiển thị"
            },
            "initComplete": function (settings, json) {
                // CSS changes
                $('#example2_filter input[type="search"]').addClass('form-control');
                $('#example2_filter input[type="search"]').attr('placeholder', 'Tìm kiếm');
                $('#example2_filter label').contents().filter(function () {
                    return this.nodeType === 3;
                }).replaceWith(' ');

                $('#example2_length label').contents().filter(function () {
                    return this.nodeType === 3;
                }).first().replaceWith('Hiển thị');
                $('#example2_length label').contents().filter(function () {
                    return this.nodeType === 3;
                }).last().replaceWith('mục');

                $('#example2_length select').addClass('form-select');
            }
        });

        table.on('draw.dt', function () {
            var pageInfo = table.page.info();

            var newInfo = 'Hiển thị ' + pageInfo.start + ' đến ' + pageInfo.end + ' trong tổng số ' + pageInfo.recordsDisplay + ' kết quả';
            $('#example2_info').html(newInfo);

        });
    });
</script>
<style>
    .modal-dialog {
        max-width: 70%;
        position: relative;
        right: -35%; /* Đẩy modal sang bên phải */
        transform: translateX(0); /* Đảm bảo modal không bị dịch chuyển thêm */
    }
</style>
<style>
    /*input tìm kiếm*/
    #example_filter input[type="search"] {
        width: 180%;
        margin-left: -80%;
        margin-bottom: 10%;
    }

    /*select hiển thị mục*/
    .dataTables_length label {
        white-space: nowrap;
        /* Ngăn các phần tử xuống dòng */
        display: flex;
        /* Hiển thị label và select trên cùng một dòng */
        align-items: center;
        /* Canh chỉnh label và select theo chiều dọc */
    }

    .dataTables_length select {
        margin-left: 5px;
        /* Tạo khoảng cách giữa label và select */
    }

    .dataTables_length label:after {
        /* Sử dụng pseudo-element :after để ẩn văn bản cuối cùng */
        content: '';
        /* Xóa nội dung */
    }

    .errorInput {
        color: red;
        font-weight: bold;
    }
</style>
<!--    thư viện của bảng tích hợp tìm kiếm end-->

<!--  css + js chọn voucher-->
<style>
    .muted-radio {
        opacity: 0.5;
        /* hoặc bất kỳ kiểu định dạng nào bạn muốn để làm mờ */
        pointer-events: none;
        /* Ngăn chặn sự kiện click */
    }

    .muted-card {
        opacity: 0.5;
        /* hoặc kiểu định dạng mờ khác */
    }
    .muted-card {
        opacity: 0.5; /* Làm mờ thẻ */
        pointer-events: none; /* Ngăn click vào thẻ */
    }

    .muted-radio {
        display: none; /* Ẩn radio button nếu không đủ điều kiện */
    }


</style>
<style>
    .hoa-don .btn-outline-primary {
        margin: 5px;
        border-radius: 5px;
        transition: all 0.3s ease;
    }

    .hoa-don .btn-outline-primary.active {
        background-color: #0d6efd;
        color: white;
        box-shadow: 0 0 10px rgba(13, 110, 253, 0.5);
    }

    .hoa-don .btn-outline-primary:hover {
        background-color: #0d6efd;
        color: white;
    }
</style>
// ... existing code ...
<div class="hoa-don">
    <div th:each="hd : ${listHoaDon}" class="btn-group" role="group"
         aria-label="Basic outlined example">
        <a th:text="${hd.maHoaDon}"
           th:href="@{'/ban-hang-tai-quay/hoa-don/' + ${hd.id}}"
           th:class="${hd.id == hoaDon.id ? 'btn btn-outline-primary active' : 'btn btn-outline-primary'}"></a>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const currentPath = window.location.pathname;
        const hoaDonLink = document.getElementById("ban-hang-nav");
        const tablesNav = document.getElementById("tables-nav");
        const tablesNavParent = tablesNav.closest(".nav-item"); // Lấy phần tử cha

        if (currentPath.includes("/ban-hang-tai-quay/hoa-don")) {
            hoaDonLink.classList.remove("collapsed");
            hoaDonLink.classList.add("active");
        }

        // Nếu không phải trang thuộc Quản Lý Tài Khoản, đóng lại phần đó
        if (!currentPath.includes("/admin/nhan-vien") && !currentPath.includes("/admin/khach-hang")) {
            tablesNav.classList.remove("show"); // Đóng danh sách con
            tablesNavParent.querySelector(".nav-link").classList.add("collapsed"); // Thu gọn
        }
    });

</script>
<script>
    function handleRadioVoucher(rowIndex) {
        var index = rowIndex.getAttribute('data-index');
        if (index == null) {
            return;
        }
        console.log(index)
        // Tách chuỗi thành mảng các phần tử (số)
        var numbersArray = index.split(' ');

        // Chuyển đổi các phần tử thành số nguyên
        var idVoucher = parseInt(numbersArray[0], 10);
        var phamTramGiam = parseInt(numbersArray[1], 10);
        var giaTriGiam = parseInt(numbersArray[2], 10);
        // In ra kết quả
        console.log('Số thứ nhất:', idVoucher);
        console.log('Số thứ hai:', phamTramGiam);

        var voucher1 = document.getElementById("voucherID"); //ok
        voucher1.value = idVoucher

        var moneyVoucher = document.getElementById("moneyVoucher"); //ok
        //tổng tiền khi giảm
        var totalElementSale = document.getElementById("tongGiaValue");  //ok

        //tổng tiền khi giảm input
        var tongTienAndSale = document.getElementById("tongAll"); //ok

        //tổng tiền
        var tongTienHang = document.getElementById("totalAmount"); //ok

        var shippingFeeResult = document.getElementById("phi-van-chuyen"); //ok

        var detailVoucher = document.getElementById("c_code");

        // Parse số từ text, loại bỏ 'VNĐ' và dấu chấm ngăn cách
        var shippingFeeResultInt = parseInt(shippingFeeResult.innerText.replace(/\./g, '').replace(' VNĐ', ''));
        var tongTienHangInt = parseInt(tongTienHang.innerText.replace(/\./g, '').replace(' VNĐ', ''));

        var tongTienGiamTheoPhanTram = ((tongTienHangInt * phamTramGiam) / 100)
        if (tongTienGiamTheoPhanTram > giaTriGiam) {
            tongTienGiamTheoPhanTram = giaTriGiam
        }

        // Format số với dấu chấm ngăn cách hàng nghìn
        function formatMoney(amount) {
            return amount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        }

        detailVoucher.value = '-' + formatMoney(tongTienGiamTheoPhanTram) + ' VNĐ';
        moneyVoucher.innerText = formatMoney(tongTienGiamTheoPhanTram) + ' VNĐ';

        var tongTienSauGiam = shippingFeeResultInt + tongTienHangInt - tongTienGiamTheoPhanTram;

        tongTienAndSale.value = tongTienSauGiam;
        totalElementSale.innerHTML = formatMoney(tongTienSauGiam) + ' VNĐ';
        document.getElementById('giamGiaInput').value = tongTienGiamTheoPhanTram.toFixed(0);
    }

    function checkAndDisplayVouchers() {
        var totalAmountElement = document.getElementById('totalAmount');
        if (!totalAmountElement) {
            console.error("Không tìm thấy phần tử #totalAmount");
            return;
        }

        var totalAmount = parseFloat(totalAmountElement.innerText.replace(/[,.]/g, '').replace(' VND', '').trim());
        console.log("Tổng tiền đơn hàng:", totalAmount);

        document.querySelectorAll('.card.mb-3').forEach(function (card) {
            var donToiThieuElement = card.querySelector('.donToiThieu');
            var radio = card.querySelector('input[name="voucherRadio"]');
            var thongBao = card.querySelector('.thongBaoThieuTien');

            if (!donToiThieuElement || !radio || !thongBao) {
                console.warn("Không tìm thấy một số phần tử trong thẻ voucher.");
                return;
            }

            var voucherGiaTriDonToiThieu = parseFloat(donToiThieuElement.innerText.replace(/[,.]/g, '').replace('Đơn Tối Thiểu ', '').replace(' VND', '').trim());

            console.log(`Voucher yêu cầu tối thiểu: ${voucherGiaTriDonToiThieu}, Tổng đơn hàng: ${totalAmount}`);

            if (voucherGiaTriDonToiThieu > totalAmount) {
                radio.disabled = true;
                radio.classList.add('muted-radio'); // Ẩn radio button
                card.classList.add('muted-card'); // Làm mờ voucher
                thongBao.style.display = 'block';

                var soTienThieu = voucherGiaTriDonToiThieu - totalAmount;
                thongBao.innerText = `Cần mua thêm ${soTienThieu.toLocaleString()} VND để sử dụng voucher này.`;
            } else {
                radio.disabled = false;
                radio.classList.remove('muted-radio'); // Hiển thị radio nếu đủ điều kiện
                card.classList.remove('muted-card'); // Bỏ làm mờ voucher
                thongBao.style.display = 'none';
            }
        });

        $('#voucher').modal('show');
    }






    function boChonVoucher() {
        location.reload();
    }
</script>
<!--  css + js chọn voucher-->
<script src="../../static/js/banHangValid.js"></script>
<script>

    function disabledInput() {
        const checkGiaoHang = document.getElementById('toggleVisibility')
        const inputHoVaTen = document.getElementById('inputHoVaTen')
        const inputSoDienThoai = document.getElementById('inputSoDienThoai')
        const citySelect = document.getElementById('citySelect')
        const districtSelect = document.getElementById('districtSelect')
        const wardSelect = document.getElementById('wardSelect')
        const inputDiaChiCuThe = document.getElementById('inputDiaChiCuThe')
        const inputGhiChu = document.getElementById('inputGhiChu')

        checkGiaoHang.disabled = true;
        inputHoVaTen.readOnly = true;
        inputSoDienThoai.readOnly = true;
        citySelect.disabled = true;
        districtSelect.disabled = true;
        wardSelect.disabled = true;
        inputDiaChiCuThe.readOnly = true;
        inputGhiChu.readOnly = true;
    }

    if ('[[${hoaDon.trangThai}]]' != 0 && '[[${hoaDon.trangThai}]]' != 1 && '[[${hoaDon.trangThai}]]' != -1 && '[[${hoaDon.trangThai}]]' != 4) {
        disabledInput();
    }


</script>
<!--Thông báo thành công-->
<div class="toast-container position-fixed top-0 end-0 p-3">
    <script th:if="${checkThongBao=='thanhCong'}">
        window.addEventListener('DOMContentLoaded', (event) => {
            // Hiển thị modal
            var liveToast = new bootstrap.Toast(document.getElementById('liveToastSuccess'));
            liveToast.show();
        });
    </script>

    <div id="liveToastSuccess" class="toast" role="alert" aria-live="assertive" aria-atomic="true"
         style="  background-color: rgba(62, 189, 97,0.2);border:2px solid #3ebd61;  border-radius:1rem;">
        <div class="toast-body">
            <div class="row g-3">
                <div class="col-md-2">
                    <img src="../../../static/img/successful_notification.png" alt="" style="margin: auto">
                </div>
                <div class="col-md-8" style=" margin-top:6.3%">
                        <span style="
                    text-align: center;
                    font-size: 1rem; /* Kích thước phông chữ */
                    font-weight: bold; /* Độ đậm của chữ */
                    color: #3ebd61;">
                            [[${thongBao}]]</span>
                </div>
                <div class="col-md-2">
                    <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"
                            style="font-size: 1.5rem;margin: auto"></button>
                </div>

            </div>
        </div>
    </div>
</div>
<!--Thông báo thành công end-->

<!--Thông báo cảnh báo-->
<div class="toast-container position-fixed top-0 end-0 p-3">
    <script th:if="${checkThongBao=='canhBao'}">
        window.addEventListener('DOMContentLoaded', (event) => {
            // Hiển thị modal
            var liveToast = new bootstrap.Toast(document.getElementById('liveToastWarning'));
            liveToast.show();
        });
    </script>
    <div id="liveToastWarning" class="toast" role="alert" aria-live="assertive" aria-atomic="true"
         style=" background-color: rgba(239, 148, 0, 0.2);border:2px solid #fcca1b;  border-radius:1rem;">
        <div class="toast-body">
            <div class="row g-3">
                <div class="col-md-2">
                    <img src="../../../static/img/successful_warning.png" alt="" style="margin: auto">
                </div>
                <div class="col-md-8" style=" margin-top:6.3%">
                        <span style="
                    text-align: center;
                    font-size: 1rem; /* Kích thước phông chữ */
                    font-weight: bold; /* Độ đậm của chữ */
                    color: #fcca1b;">
                            [[${thongBao}]]</span>
                </div>
                <div class="col-md-2">
                    <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"
                            style="font-size: 1.5rem;margin: auto"></button>
                </div>

            </div>
        </div>
    </div>
</div>
<!--Thông báo cảnh báo end-->

<!--Thông báo thất bại-->
<div class="toast-container position-fixed top-0 end-0 p-3">
    <script th:if="${checkThongBao=='thatBai'}">

        window.addEventListener('DOMContentLoaded', (event) => {
            // Hiển thị modal
            var liveToast = new bootstrap.Toast(document.getElementById('liveToastDanger'));
            liveToast.show();
        });
    </script>
    <div id="liveToastDanger" class="toast" role="alert" aria-live="assertive" aria-atomic="true"
         style="background-color: rgb(252,134,134);border:2px solid #ff2020;border-radius:1rem;">
        <div class="toast-body">
            <div class="row g-3">
                <div class="col-md-2">
                    <img src="../../../static/img/successful_danger.png" alt="" style="margin: auto">
                </div>
                <div class="col-md-8" style=" margin-top:6.3%">
                        <span style="
                    text-align: center;
                    font-size: 1rem; /* Kích thước phông chữ */
                    font-weight: bold; /* Độ đậm của chữ */
                    color: white;">
                            [[${thongBao}]]</span>
                </div>
                <div class="col-md-2">
                    <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"
                            style="font-size: 1.5rem;margin: auto"></button>
                </div>

            </div>
        </div>
    </div>
</div>

<script>
    // Hàm kiểm soát hiển thị modal
    function showErrorModal() {
        const modal = new bootstrap.Modal(document.getElementById('them-khach-hang'));
        
        // Ngăn modal tự động đóng và reset
        $('#them-khach-hang').modal({
            backdrop: 'static',
            keyboard: false,
            show: true
        });
        
        // Thêm nút đóng modal
        const closeButton = document.createElement('button');
        closeButton.className = 'btn btn-secondary';
        closeButton.textContent = 'Đóng';
        closeButton.onclick = function() {
            modal.hide();
        };
        
        // Thêm nút đóng vào modal footer
        const modalFooter = document.querySelector('#them-khach-hang .modal-footer');
        if (modalFooter && !modalFooter.querySelector('.btn-secondary')) {
            modalFooter.appendChild(closeButton);
        }
    }

    // Kiểm tra nếu có thông báo lỗi thì hiển thị modal
    document.addEventListener('DOMContentLoaded', function() {
        const checkThongBao = '[[${checkThongBao}]]';
        const errorHoVaTen = '[[${errorHoVaTen}]]';
        
        if (checkThongBao === 'thaiBai' && errorHoVaTen) {
            // Sử dụng setTimeout để đảm bảo DOM đã load xong
            setTimeout(function() {
                showErrorModal();
            }, 100);
        }
    });

    function validThemKhachHang() {
        let isValid = true;
        const hoVaTen = document.getElementById('hoVaTen').value.trim();
        const errorHoVaTen = document.getElementById('errorHoVaTen');
        
        // Validate tên khách hàng
        if (hoVaTen === '') {
            errorHoVaTen.textContent = 'Vui lòng nhập họ và tên';
            errorHoVaTen.style.color = 'red';
            isValid = false;
        } else if (!/^[a-zA-ZÀ-ỹ\s]+$/.test(hoVaTen)) {
            errorHoVaTen.textContent = 'Họ và tên chỉ được chứa chữ cái và dấu cách';
            errorHoVaTen.style.color = 'red';
            isValid = false;
        } else {
            errorHoVaTen.textContent = '';
        }

        // Các validate khác giữ nguyên
        const email = document.getElementById('email').value;
        const errorEmail = document.getElementById('errorEmail');
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

        if (email === '') {
            errorEmail.textContent = 'Vui lòng nhập email';
            errorEmail.style.color = 'red';
            isValid = false;
        } else if (!emailRegex.test(email)) {
            errorEmail.textContent = 'Email không hợp lệ';
            errorEmail.style.color = 'red';
            isValid = false;
        } else {
            errorEmail.textContent = '';
        }

        const soDienThoai = document.getElementById('soDienThoai').value;
        const errorSoDienThoai = document.getElementById('errorSoDienThoai');
        const phoneRegex = /^0[0-9]{9}$/;

        if (soDienThoai === '') {
            errorSoDienThoai.textContent = 'Vui lòng nhập số điện thoại';
            errorSoDienThoai.style.color = 'red';
            isValid = false;
        } else if (!phoneRegex.test(soDienThoai)) {
            errorSoDienThoai.textContent = 'Số điện thoại không hợp lệ';
            errorSoDienThoai.style.color = 'red';
            isValid = false;
        } else {
            errorSoDienThoai.textContent = '';
        }

        return isValid;
    }
</script>

<script>
function validateKhachHangInput(input, fieldName) {
    const value = input.value.trim();
    const errorElement = document.getElementById(fieldName + 'Error');
    
    if (!value) {
        errorElement.textContent = 'Vui lòng nhập ' + (fieldName === 'tenTaiKhoan' ? 'tên tài khoản' : 'tên khách hàng');
        return false;
    }
    
    // Kiểm tra khoảng trống ở đầu và cuối
    if (value !== input.value) {
        errorElement.textContent = 'Không được chứa khoảng trống ở đầu hoặc cuối';
        return false;
    }
    
    // Kiểm tra ký tự đặc biệt
    const specialChars = /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]+/;
    if (specialChars.test(value)) {
        errorElement.textContent = 'Không được chứa ký tự đặc biệt';
        return false;
    }
    
    // Kiểm tra khoảng trống liên tiếp
    if (value.includes('  ')) {
        errorElement.textContent = 'Không được chứa khoảng trống liên tiếp';
        return false;
    }
    
    errorElement.textContent = '';
    return true;
}

function validateNgaySinh(input) {
    const value = input.value;
    const errorElement = document.getElementById('ngaySinhError');
    
    if (!value) {
        errorElement.textContent = 'Vui lòng chọn ngày sinh';
        return false;
    }
    
    const selectedDate = new Date(value);
    const currentDate = new Date();
    const minDate = new Date('1900-01-01');
    
    if (selectedDate > currentDate) {
        errorElement.textContent = 'Ngày sinh không được lớn hơn ngày hiện tại';
        return false;
    }
    
    if (selectedDate < minDate) {
        errorElement.textContent = 'Ngày sinh phải lớn hơn năm 1900';
        return false;
    }
    
    errorElement.textContent = '';
    return true;
}

function validateSoDienThoai(input) {
    const value = input.value.trim();
    const errorElement = document.getElementById('soDienThoaiError');
    
    if (!value) {
        errorElement.textContent = 'Vui lòng nhập số điện thoại';
        return false;
    }
    
    // Kiểm tra xem có chứa ký tự không phải số không
    if (!/^\d+$/.test(value)) {
        errorElement.textContent = 'Số điện thoại chỉ được chứa số';
        return false;
    }
    
    const phoneRegex = /^0[0-9]{9}$/;
    if (!phoneRegex.test(value)) {
        errorElement.textContent = 'Số điện thoại phải bắt đầu bằng số 0 và có 10 chữ số';
        return false;
    }
    
    errorElement.textContent = '';
    return true;
}

function validateEmail(input) {
    const value = input.value.trim();
    const errorElement = document.getElementById('emailError');
    
    if (!value) {
        errorElement.textContent = 'Vui lòng nhập email';
        return false;
    }
    
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(value)) {
        errorElement.textContent = 'Email không hợp lệ';
        return false;
    }
    
    errorElement.textContent = '';
    return true;
}

function validThemKhachHang() {
    const tenTaiKhoan = document.querySelector('input[th\\:field="*{tenTaiKhoan}"]');
    const hoVaTen = document.querySelector('input[th\\:field="*{hoVaTen}"]');
    const ngaySinh = document.querySelector('input[th\\:field="*{ngaySinh}"]');
    const soDienThoai = document.querySelector('input[th\\:field="*{soDienThoai}"]');
    const email = document.querySelector('input[th\\:field="*{email}"]');
    
    const validTenTaiKhoan = validateKhachHangInput(tenTaiKhoan, 'tenTaiKhoan');
    const validHoVaTen = validateKhachHangInput(hoVaTen, 'hoVaTen');
    const validNgaySinh = validateNgaySinh(ngaySinh);
    const validSoDienThoai = validateSoDienThoai(soDienThoai);
    const validEmail = validateEmail(email);
    
    return validTenTaiKhoan && validHoVaTen && validNgaySinh && validSoDienThoai && validEmail;
}
</script>

</body>
</html>